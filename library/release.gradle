// ./gradlew clean build :creditor-merchant-library:generateLibraryRelease
apply plugin: 'maven'

def localReleaseDest = "${buildDir}/release/${version}"

task sourcesJar(type: Jar) {
    archiveClassifier.set('sources')
    from android.sourceSets.main.java.srcDirs
}

afterEvaluate {

    uploadArchives {
        repositories.mavenDeployer {
            pom.groupId = project.CCL_GROUP_ID
            pom.artifactId = project.CCL_ARTIFACT_ID
            pom.version = project.CCL_VERSION
            repository(url: "file://${localReleaseDest}")
        }
    }

    task zipRelease(type: Zip) {
        dependsOn uploadArchives
        from localReleaseDest
        destinationDir buildDir
        archiveName "release-${project.CCL_VERSION}.zip"
    }

    task generateLibraryRelease {
        dependsOn zipRelease
        doLast {
            println "Release ${project.CCL_VERSION} can be found at ${localReleaseDest}/"
            println "Release ${project.CCL_VERSION} zipped can be found ${buildDir}/release-${project.CCL_VERSION}.zip"
        }
    }
}

artifacts {
    archives sourcesJar
}